@{
    Layout = null;
}

<link rel="stylesheet" href="~/css/registro.css">



<button class="back-btn" onclick="window.history.back()">← Volver</button>

<div class="glass-container">
    <h2>Crear Cuenta</h2>
    <form>
        <div class="input-group">
            <input type="text" id="nombreCompleto" required>
            <label>Nombre completo</label>
        </div>
        <div class="input-group">
            <input type="email" id="correoElectronico" required>
            <label>Correo electrónico</label>
        </div>
        <div class="input-group">
            <input type="text" id="nombreUsuario" required>
            <label>Nombre de usuario</label>
        </div>
        <div class="input-group">
            <input type="password" id="contrasena" required>
            <label>Contraseña</label>
        </div>
        <div class="input-group">
            <input type="password" id="confirmarContrasena" required>
            <label>Confirmar contraseña</label>
        </div>
        <div class="terms">
            <label>
                <input type="checkbox" id="terminos" required>
                <span>Acepto los <a href="#">términos y condiciones</a></span>
            </label>
        </div>

        <button type="submit" class="register-btn">Registrarse</button>

        <div class="login-link">
            <p>¿Ya tienes una cuenta? <a asp-controller="Home" asp-action="login">Inicia sesión</a></p>
        </div>
    </form>
</div>


<script>
    document.addEventListener('DOMContentLoaded', function() {
        const form = document.querySelector('form');

        form.addEventListener('submit', async function(event) {
            event.preventDefault(); // Evita el envío tradicional del formulario

            // Selecciona por ID para mayor claridad y robustez
            const nombreCompleto = document.getElementById('nombreCompleto').value;
            const correoElectronico = document.getElementById('correoElectronico').value;
            const nombreUsuario = document.getElementById('nombreUsuario').value;
            const contrasena = document.getElementById('contrasena').value;
            const confirmarContrasena = document.getElementById('confirmarContrasena').value;
            const terminosAceptados = document.getElementById('terminos').checked;

            // Validación básica en el cliente
            if (contrasena !== confirmarContrasena) {
                alert('Las contraseñas no coinciden.');
                return;
            }

            if (!terminosAceptados) {
                alert('Debes aceptar los términos y condiciones.');
                return;
            }

            const data = {
                        nombreCompleto: nombreCompleto,
                        correoElectronico: correoElectronico,
                        nombreUsuario: nombreUsuario,
                        contrasena: contrasena
                    };

            try {
                const response = await fetch('https://localhost:7024/api/Registro', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });

                if (response.ok) {
                    const result = await response.json();
                    alert(result.message);
                    form.reset();
                    window.location.href = 'login';
                } else {
                    const errorData = await response.json();
                    alert(`Error al registrar: ${errorData.message || response.statusText}`);
                }
            } catch (error) {
                console.error('Error al conectar con la API:', error);
                alert('Ocurrió un error de conexión. Inténtalo de nuevo más tarde.');
            }
        });
    });
</script>