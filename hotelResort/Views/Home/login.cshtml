@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{

    Layout = null;
}

<link rel="stylesheet" href="~/css/login.css">


<!-- Botón para volver atrás -->
<button class="back-btn" onclick="window.history.back()">← Volver</button>

<div class="glass-container">
    <h2>Login</h2>
    <form>
        <div class="input-group">
            <input type="text" required>
            <label>Username</label>
        </div>

        <div class="input-group">
            <input type="password" required>
            <label>Password</label>
        </div>

        <div class="remember-forgot">
            <label><input type="checkbox">remember-forgot</label>
            <a href="#">Forgot Password</a>
        </div>

        <button type="submit" class="login-btn">Login</button>
        <div class="register-link">
            <p>Don't have an account? <a asp-controller="Home" asp-action="registro">Register</a></p>
        </div>
    </form>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const form = document.querySelector('form'); // Selecciona el formulario

        form.addEventListener('submit', async function(event) {
            event.preventDefault(); // Evita el envío tradicional 

            const usernameInput = form.querySelector('input[type="text"]');
            const passwordInput = form.querySelector('input[type="password"]');

            const nombreUsuario = usernameInput ? usernameInput.value : '';
            const contrasena = passwordInput ? passwordInput.value : '';


            if (!nombreUsuario || !contrasena) {
                alert('Por favor, ingresa tu nombre de usuario y contraseña.');
                return;
            }

            const data = {
                nombreUsuario: nombreUsuario,
                contrasena: contrasena
            };

            try {
                const response = await fetch('https://localhost:7024/api/Registro/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });

                const result = await response.json();

                if (response.ok) { 
                    alert(result.message);
                    form.reset(); 
                   
                    if (result.redirectTo) {
                        window.location.href = '/Home/Habitaciones';
                    }
                } else {
                    alert(`Error de inicio de sesión: ${result.message || response.statusText}`);
                }
            } catch (error) {
                console.error('Error al conectar con la API:', error);
                alert('Ocurrió un error de conexión. Inténtalo de nuevo más tarde.');
            }
        });
    });
</script>